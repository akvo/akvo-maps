Author: Sandro Santilli <strk@kbt.io>

Last-Modified: 2017-02-28

## Tiler authentication

As a proof of concept, the Akvo Tiler Service map creation endpoint
is being protected by an authentication-requiring fence implemented
with nginx (resty) and lua (lua-resty-openidc).

This is done by requiring a valid JSON Web Token (JWT) in the
Authorization header ("Authorization: Bearer <token>") of HTTP POST
requests to the tiler's map creation endpoint. The nginx configuration
will prevent *any* POST not accompanied by such valid token, while
proxying the valid ones to the underlying service layer with an X-USER
header set to the email of the authenticated user.

The nginx.conf file contains the certificate of the authenticator required
to validate authentication tokens and the URL of the underlying service.

In top-level directory a shell script util/get_token.sh is provided to
obtain a JWT from username/password pair, and the viewer/index.html
viewer adds an input field to enter such token.

Requests made with the GET method are directly proxied to the underlying
service while OPTIONS requests are served by nginx itself mostly to
document the allowed "Authorization" header.

